<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Lastwar Toolbox</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
		<div id="wrapper">

			<!-- Header -->
			<header id="header">
				<div class="logo">
					<span class="icon fa-gem"></span>
				</div>
				<div class="content">
					<div class="inner">
						<h1>Lastwar Toolbox</h1>
						<p>最後的戰爭 賽季升級計算</p>
					</div>
				</div>
				<nav>
					<ul>
						<li><a href="#s4">賽季 4</a></li>
						<li><a href="#s4-resistance">S4 抗性計算</a></li>
						<li><a href="#s3">賽季 3</a></li>
						<li><a href="#s2">賽季 2</a></li>
						<!-- <li><a href="#about">About</a></li>
						<li><a href="#contact">Contact</a></li> -->
						<!-- 如有需要，也可將上方連結移至此處 -->
					</ul>
				</nav>
			</header>

			<!-- Main -->
			<div id="main">

				<!-- s2 區塊：熔爐升級時間計算 -->
				<article id="s2">
					<h2 class="major">熔爐升級時間計算 (S2)</h2>
					<form>
						<div id="s2-selects-container"></div>
						<div>
							<label>你現在有：
								<input type="text" id="s2-current-resource" placeholder="鈦合金數量">
							</label>
						</div>
						<div>
							<label>高溫溶爐下一級總共需要：
								<input type="text" id="s2-needed-resource" placeholder="所需鈦合金">
							</label>
						</div>
						<button type="button" class="button primary" onclick="calculateS2Output()" style="margin-bottom:20px;">開始計算</button>
						<div id="s2-total-output">每小時總產出: 0</div>
						<div id="s2-difference">你還差：0</div>
						<div id="s2-time-needed">需要 0 小時 0 分鐘</div>
						<div id="s2-upgrade-time">預計可升級時間：</div>
					</form>
				</article>

				<!-- s3 區塊：詛咒研究所升級時間計算 -->
				<article id="s3">
					<h2 class="major">詛咒研究所升級時間計算 (S3)</h2>
					<form>
						<div id="s3-selects-container"></div>
						<div>
							<label>你現在有：
								<input type="text" id="s3-current-resource" placeholder="聖水數量">
							</label>
						</div>
						<div>
							<label>詛咒研究所下一級總共需要：
								<input type="text" id="s3-needed-resource" placeholder="所需聖水">
							</label>
						</div>
						<button type="button" class="button primary"  onclick="calculateS3Output()" style="margin-bottom:20px;">開始計算</button>
						<div id="s3-total-output">每小時總產出: 0</div>
						<div id="s3-difference">你還差：0</div>
						<div id="s3-time-needed">需要 0 小時 0 分鐘</div>
						<div id="s3-upgrade-time">預計可升級時間：</div>
					</form>
				</article>

				<!-- s4 區塊：光電研究所升級時間計算 -->
				<article id="s4">
					<h2 class="major">光電研究所升級時間計算 (S4)</h2>
					<form>
						<div id="s4-selects-container"></div>
						<div>
							<label>你現在有：
								<input type="text" id="s4-current-resource" placeholder="石英數量">
							</label>
						</div>
						<div>
							<label>光電研究所下一級總共需要：
								<input type="text" id="s4-needed-resource" placeholder="所需石英">
							</label>
						</div>
						<button type="button" class="button primary"  onclick="calculateS4Output()" style="margin-bottom:20px;">開始計算</button>
						<div id="s4-total-output">每小時總產出: 0</div>
						<div id="s4-difference">你還差：0</div>
						<div id="s4-time-needed">需要 0 小時 0 分鐘</div>
						<div id="s4-upgrade-time">預計可升級時間：</div>
					</form>
				</article>

				<!-- s4 抗性計算器，5-7 抗性不確定 -->
				<article id="s4-resistance">
					<h2 class="major">S4 抗性計算機</h2>
					<form method="post" action="#">
						<div class="fields">
							<div class="field">
								<label for="research-level">光電研究所等級</label>
								<select id="research-level" name="research-level">
									<option value="">選擇等級</option>
									<option value="1">等級 1 (100 抗性)</option>
									<option value="2">等級 2 (200 抗性)</option>
									<option value="3">等級 3 (300 抗性)</option>
									<option value="4">等級 4 (400 抗性)</option>
									<option value="5">等級 5 (500 抗性)</option>
									<option value="6">等級 6 (850 抗性)</option>
									<option value="7">等級 7 (1000 抗性)</option>
									<option value="8">等級 8 (1250 抗性)</option>
									<option value="9">等級 9 (1500 抗性)</option>
									<option value="10">等級 10 (1750 抗性)</option>
									<option value="11">等級 11 (2000 抗性)</option>
									<option value="12">等級 12 (2250 抗性)</option>
									<option value="13">等級 13 (2500 抗性)</option>
									<option value="14">等級 14 (2750 抗性)</option>
									<option value="15">等級 15 (3000 抗性)</option>
									<option value="16">等級 16 (3400 抗性)</option>
									<option value="17">等級 17 (3800 抗性)</option>
									<option value="18">等級 18 (4200 抗性)</option>
									<option value="19">等級 19 (4600 抗性)</option>
									<option value="20">等級 20 (5000 抗性)</option>
									<option value="21">等級 21 (5500 抗性)</option>
									<option value="22">等級 22 (6000 抗性)</option>
									<option value="23">等級 23 (6500 抗性)</option>
									<option value="24">等級 24 (7000 抗性)</option>
									<option value="25">等級 25 (7500 抗性)</option>
									<option value="26">等級 26 (8000 抗性)</option>
									<option value="27">等級 27 (8500 抗性)</option>
									<option value="28">等級 28 (9000 抗性)</option>
									<option value="29">等級 29 (9500 抗性)</option>
									<option value="30">等級 30 (10000 抗性)</option>
								</select>
							</div>
							<div class="field">
								<label for="l-buff">燈塔亮度</label>
								<select id="l-buff" name="l-buff">
									<option value="0">L0 (+0 抗性)</option>
									<option value="1">L1 (+50 抗性)</option>
									<option value="2">L2 (+150 抗性)</option>
									<option value="3">L3/4 (+250 抗性)</option>
								</select>
							</div>
							<div class="field half">
								<input type="checkbox" id="weekly-card-buff" name="weekly-card-buff">
								<label for="weekly-card-buff">週卡 (+250 抗性)</label>
							</div>
							<div class="field half">
								<input type="checkbox" id="guardian-buff" name="guardian-buff">
								<label for="guardian-buff">守護者 (+250 抗性)</label>
							</div>
						</div>
						<ul class="actions">
							<li><input type="button" value="計算總抗性" class="primary" onclick="calculateResistance()" /></li>
						</ul>
						<div id="base-resistance" style="margin-bottom: 10px;">基礎抗性: 0</div>
						<div id="buff-details" style="margin-bottom: 10px;">Buff 詳情: </div>
						<div id="total-resistance" style="font-size: 1.2em; font-weight: bold; color: #ff6b6b;">總抗性: 0</div>
					</form>
				</article>

				<!-- Elements -->
				<article id="elements">
					<h2 class="major">Elements</h2>

					<section>
						<h3 class="major">Text</h3>
						<p>This is <b>bold</b> and this is <strong>strong</strong>. This is <i>italic</i> and this is <em>emphasized</em>.
						This is <sup>superscript</sup> text and this is <sub>subscript</sub> text.
						This is <u>underlined</u> and this is code: <code>for (;;) { ... }</code>. Finally, <a href="#">this is a link</a>.</p>
						<hr />
						<h2>Heading Level 2</h2>
						<h3>Heading Level 3</h3>
						<h4>Heading Level 4</h4>
						<h5>Heading Level 5</h5>
						<h6>Heading Level 6</h6>
						<hr />
						<h4>Blockquote</h4>
						<blockquote>Fringilla nisl. Donec accumsan interdum nisi, quis tincidunt felis sagittis eget tempus euismod. Vestibulum ante ipsum primis in faucibus vestibulum. Blandit adipiscing eu felis iaculis volutpat ac adipiscing accumsan faucibus. Vestibulum ante ipsum primis in faucibus lorem ipsum dolor sit amet nullam adipiscing eu felis.</blockquote>
						<h4>Preformatted</h4>
						<pre><code>i = 0;

				while (!deck.isInOrder()) {
				print 'Iteration ' + i;
				deck.shuffle();
				i++;
				}

				print 'It took ' + i + ' iterations to sort the deck.';</code></pre>
					</section>

					<section>
						<h3 class="major">Lists</h3>

						<h4>Unordered</h4>
						<ul>
							<li>Dolor pulvinar etiam.</li>
							<li>Sagittis adipiscing.</li>
							<li>Felis enim feugiat.</li>
						</ul>

						<h4>Alternate</h4>
						<ul class="alt">
							<li>Dolor pulvinar etiam.</li>
							<li>Sagittis adipiscing.</li>
							<li>Felis enim feugiat.</li>
						</ul>

						<h4>Ordered</h4>
						<ol>
							<li>Dolor pulvinar etiam.</li>
							<li>Etiam vel felis viverra.</li>
							<li>Felis enim feugiat.</li>
							<li>Dolor pulvinar etiam.</li>
							<li>Etiam vel felis lorem.</li>
							<li>Felis enim et feugiat.</li>
						</ol>
						<h4>Icons</h4>
						<ul class="icons">
							<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
							<li><a href="#" class="icon brands fa-github"><span class="label">Github</span></a></li>
						</ul>

						<h4>Actions</h4>
						<ul class="actions">
							<li><a href="#" class="button primary">Default</a></li>
							<li><a href="#" class="button">Default</a></li>
						</ul>
						<ul class="actions stacked">
							<li><a href="#" class="button primary">Default</a></li>
							<li><a href="#" class="button">Default</a></li>
						</ul>
					</section>

					<section>
						<h3 class="major">Table</h3>
						<h4>Default</h4>
						<div class="table-wrapper">
							<table>
								<thead>
									<tr>
										<th>Name</th>
										<th>Description</th>
										<th>Price</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>Item One</td>
										<td>Ante turpis integer aliquet porttitor.</td>
										<td>29.99</td>
									</tr>
									<tr>
										<td>Item Two</td>
										<td>Vis ac commodo adipiscing arcu aliquet.</td>
										<td>19.99</td>
									</tr>
									<tr>
										<td>Item Three</td>
										<td> Morbi faucibus arcu accumsan lorem.</td>
										<td>29.99</td>
									</tr>
									<tr>
										<td>Item Four</td>
										<td>Vitae integer tempus condimentum.</td>
										<td>19.99</td>
									</tr>
									<tr>
										<td>Item Five</td>
										<td>Ante turpis integer aliquet porttitor.</td>
										<td>29.99</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="2"></td>
										<td>100.00</td>
									</tr>
								</tfoot>
							</table>
						</div>

						<h4>Alternate</h4>
						<div class="table-wrapper">
							<table class="alt">
								<thead>
									<tr>
										<th>Name</th>
										<th>Description</th>
										<th>Price</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td>Item One</td>
										<td>Ante turpis integer aliquet porttitor.</td>
										<td>29.99</td>
									</tr>
									<tr>
										<td>Item Two</td>
										<td>Vis ac commodo adipiscing arcu aliquet.</td>
										<td>19.99</td>
									</tr>
									<tr>
										<td>Item Three</td>
										<td> Morbi faucibus arcu accumsan lorem.</td>
										<td>29.99</td>
									</tr>
									<tr>
										<td>Item Four</td>
										<td>Vitae integer tempus condimentum.</td>
										<td>19.99</td>
									</tr>
									<tr>
										<td>Item Five</td>
										<td>Ante turpis integer aliquet porttitor.</td>
										<td>29.99</td>
									</tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="2"></td>
										<td>100.00</td>
									</tr>
								</tfoot>
							</table>
						</div>
					</section>

					<section>
						<h3 class="major">Buttons</h3>
						<ul class="actions">
							<li><a href="#" class="button primary">Primary</a></li>
							<li><a href="#" class="button">Default</a></li>
						</ul>
						<ul class="actions">
							<li><a href="#" class="button">Default</a></li>
							<li><a href="#" class="button small">Small</a></li>
						</ul>
						<ul class="actions">
							<li><a href="#" class="button primary icon solid fa-download">Icon</a></li>
							<li><a href="#" class="button icon solid fa-download">Icon</a></li>
						</ul>
						<ul class="actions">
							<li><span class="button primary disabled">Disabled</span></li>
							<li><span class="button disabled">Disabled</span></li>
						</ul>
					</section>

					<section>
						<h3 class="major">Form</h3>
						<form method="post" action="#">
							<div class="fields">
								<div class="field half">
									<label for="demo-name">Name</label>
									<input type="text" name="demo-name" id="demo-name" value="" placeholder="Jane Doe" />
								</div>
								<div class="field half">
									<label for="demo-email">Email</label>
									<input type="email" name="demo-email" id="demo-email" value="" placeholder="jane@untitled.tld" />
								</div>
								<div class="field">
									<label for="demo-category">Category</label>
									<select name="demo-category" id="demo-category">
										<option value="">-</option>
										<option value="1">Manufacturing</option>
										<option value="1">Shipping</option>
										<option value="1">Administration</option>
										<option value="1">Human Resources</option>
									</select>
								</div>
								<div class="field half">
									<input type="radio" id="demo-priority-low" name="demo-priority" checked>
									<label for="demo-priority-low">Low</label>
								</div>
								<div class="field half">
									<input type="radio" id="demo-priority-high" name="demo-priority">
									<label for="demo-priority-high">High</label>
								</div>
								<div class="field half">
									<input type="checkbox" id="demo-copy" name="demo-copy">
									<label for="demo-copy">Email me a copy</label>
								</div>
								<div class="field half">
									<input type="checkbox" id="demo-human" name="demo-human" checked>
									<label for="demo-human">Not a robot</label>
								</div>
								<div class="field">
									<label for="demo-message">Message</label>
									<textarea name="demo-message" id="demo-message" placeholder="Enter your message" rows="6"></textarea>
								</div>
							</div>
							<ul class="actions">
								<li><input type="submit" value="Send Message" class="primary" /></li>
								<li><input type="reset" value="Reset" /></li>
							</ul>
						</form>
					</section>

				</article>

			</div>

			<!-- Footer -->
			<footer id="footer">
				<p class="copyright">&copy; #188 [MQM]TWWlst Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
			</footer>

		</div>

		<!-- BG -->
		<div id="bg"></div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
		<!-- 以下為合併後的計算器 script -->
		<script>
			// 統一使用的生產數據
			const levelOutput = [
				{ level: 0, output: 0 },
				{ level: 1, output: 720 },
				{ level: 2, output: 1440 },
				{ level: 3, output: 2160 },
				{ level: 4, output: 2880 },
				{ level: 5, output: 3600 },
				{ level: 6, output: 4320 },
				{ level: 7, output: 5040 },
				{ level: 8, output: 5760 },
				{ level: 9, output: 6480 },
				{ level: 10, output: 7200 },
				{ level: 11, output: 7920 },
				{ level: 12, output: 8640 },
				{ level: 13, output: 9360 },
				{ level: 14, output: 10080 },
				{ level: 15, output: 10800 },
				{ level: 16, output: 11520 },
				{ level: 17, output: 12240 },
				{ level: 18, output: 12960 },
				{ level: 19, output: 13680 },
				{ level: 20, output: 14400 },
				{ level: 21, output: 15120 },
				{ level: 22, output: 15840 },
				{ level: 23, output: 16560 },
				{ level: 24, output: 17280 },
				{ level: 25, output: 18000 },
				{ level: 26, output: 18720 },
				{ level: 27, output: 19440 },
				{ level: 28, output: 20160 },
				{ level: 29, output: 20880 },
				{ level: 30, output: 21600 }
			];

			// ============ 資料保存和載入功能 ============

			// 保存資料到 localStorage
			function saveData(season, data) {
				localStorage.setItem(`lastwar-toolbox-${season}`, JSON.stringify(data));
			}

			// 從 localStorage 載入資料
			function loadData(season) {
				const saved = localStorage.getItem(`lastwar-toolbox-${season}`);
				return saved ? JSON.parse(saved) : null;
			}

			// 通用保存函式
			function saveFormData(season) {
				const data = {
					factories: {},
					currentResource: document.getElementById(`${season}-current-resource`).value,
					neededResource: document.getElementById(`${season}-needed-resource`).value
				};

				for (let i = 1; i <= 5; i++) {
					const select = document.getElementById(`${season}-factory${i}`);
					data.factories[`factory${i}`] = select.value;
				}

				saveData(season, data);
			}

			// 通用載入函式
			function loadFormData(season) {
				const data = loadData(season);
				if (data) {
					// 載入工廠等級
					for (let i = 1; i <= 5; i++) {
						const select = document.getElementById(`${season}-factory${i}`);
						if (data.factories && data.factories[`factory${i}`]) {
							select.value = data.factories[`factory${i}`];
						}
					}

					// 載入資源數量
					if (data.currentResource) {
						document.getElementById(`${season}-current-resource`).value = data.currentResource;
					}
					if (data.neededResource) {
						document.getElementById(`${season}-needed-resource`).value = data.neededResource;
					}
				}
			}

			// 為所有輸入欄位添加自動保存功能
			function addAutoSave(season) {
				// 工廠下拉選單自動保存
				for (let i = 1; i <= 5; i++) {
					const select = document.getElementById(`${season}-factory${i}`);
					select.addEventListener('change', () => saveFormData(season));
				}

				// 資源輸入欄位自動保存
				const currentInput = document.getElementById(`${season}-current-resource`);
				const neededInput = document.getElementById(`${season}-needed-resource`);
				
				currentInput.addEventListener('input', () => saveFormData(season));
				neededInput.addEventListener('input', () => saveFormData(season));
			}

			// 為輸入欄位添加 Enter 鍵觸發計算功能
			function addEnterKeyListener(season) {
				const currentInput = document.getElementById(`${season}-current-resource`);
				const neededInput = document.getElementById(`${season}-needed-resource`);
				
				const handleEnterKey = (event) => {
					if (event.key === 'Enter') {
						event.preventDefault();
						// 根據不同賽季呼叫對應的計算函式
						if (season === 's2') {
							calculateS2Output();
						} else if (season === 's3') {
							calculateS3Output();
						} else if (season === 's4') {
							calculateS4Output();
						}
					}
				};
				
				currentInput.addEventListener('keydown', handleEnterKey);
				neededInput.addEventListener('keydown', handleEnterKey);
			}

			// ============ s2 計算器 ============

			// 初始化 s2 的下拉選單
			function initS2() {
				const container = document.getElementById('s2-selects-container');
				for (let i = 1; i <= 5; i++) {
					const label = document.createElement('label');
					label.className = 'factory-label';
					label.textContent = `鈦合金工廠${i}：`;
					const select = document.createElement('select');
					select.id = `s2-factory${i}`;
					select.name = `s2-factory${i}`;
					select.options.add(new Option('選擇等級', ''));
					levelOutput.forEach(item => {
						select.options.add(new Option(`等級 ${item.level}`, item.level));
					});
					container.appendChild(label);
					container.appendChild(select);
					container.appendChild(document.createElement('br'));
				}
				
				// 載入之前保存的資料
				loadFormData('s2');
				// 添加自動保存功能
				addAutoSave('s2');
				// 添加 Enter 鍵觸發計算功能
				addEnterKeyListener('s2');
			}

			// s2 的計算函式
			function calculateS2Output() {
				let total = 0;
				for (let i = 1; i <= 5; i++) {
					const select = document.getElementById(`s2-factory${i}`);
					const level = parseInt(select.value);
					const item = levelOutput.find(item => item.level === level);
					const output = item ? item.output : 0;
					total += output;
				}
				document.getElementById('s2-total-output').textContent = `每小時總產出: ${total}`;

				const current = parseInt(document.getElementById('s2-current-resource').value) || 0;
				const needed = parseInt(document.getElementById('s2-needed-resource').value) || 0;
				const difference = needed - current;
				document.getElementById('s2-difference').textContent = `你還差：${difference}`;

				// 避免除以 0
				if (total <= 0) {
					document.getElementById('s2-time-needed').textContent = `無法計算時間 (產出為 0)`;
					document.getElementById('s2-upgrade-time').textContent = `預計可升級時間：無法計算`;
					return;
				}

				const hoursNeeded = difference / total;
				const hours = Math.floor(hoursNeeded);
				const minutes = Math.round((hoursNeeded - hours) * 60);
				document.getElementById('s2-time-needed').textContent = `需要 ${hours} 小時 ${minutes} 分鐘`;

				const upgradeTime = new Date(Date.now() + hoursNeeded * 3600000);
				document.getElementById('s2-upgrade-time').textContent = `預計可升級時間：${upgradeTime.toLocaleString()}`;
				
				// 保存資料
				saveFormData('s2');
			}

			// ============ s3 計算器 ============

			// 初始化 s3 的下拉選單
			function initS3() {
				const container = document.getElementById('s3-selects-container');
				for (let i = 1; i <= 5; i++) {
					const label = document.createElement('label');
					label.className = 'factory-label';
					label.textContent = `祝福之泉${i}：`;
					const select = document.createElement('select');
					select.id = `s3-factory${i}`;
					select.name = `s3-factory${i}`;
					select.options.add(new Option('選擇等級', ''));
					levelOutput.forEach(item => {
						select.options.add(new Option(`等級 ${item.level}`, item.level));
					});
					container.appendChild(label);
					container.appendChild(select);
					container.appendChild(document.createElement('br'));
				}
				
				// 載入之前保存的資料
				loadFormData('s3');
				// 添加自動保存功能
				addAutoSave('s3');
				// 添加 Enter 鍵觸發計算功能
				addEnterKeyListener('s3');
			}

			// s3 的計算函式
			function calculateS3Output() {
				let total = 0;
				for (let i = 1; i <= 5; i++) {
					const select = document.getElementById(`s3-factory${i}`);
					const level = parseInt(select.value);
					const item = levelOutput.find(item => item.level === level);
					const output = item ? item.output : 0;
					total += output;
				}
				document.getElementById('s3-total-output').textContent = `每小時總產出: ${total}`;

				const current = parseInt(document.getElementById('s3-current-resource').value) || 0;
				const needed = parseInt(document.getElementById('s3-needed-resource').value) || 0;
				const difference = needed - current;
				document.getElementById('s3-difference').textContent = `你還差：${difference}`;

				if (total <= 0) {
					document.getElementById('s3-time-needed').textContent = `無法計算時間 (產出為 0)`;
					document.getElementById('s3-upgrade-time').textContent = `預計可升級時間：無法計算`;
					return;
				}

				const hoursNeeded = difference / total;
				const hours = Math.floor(hoursNeeded);
				const minutes = Math.round((hoursNeeded - hours) * 60);
				document.getElementById('s3-time-needed').textContent = `需要 ${hours} 小時 ${minutes} 分鐘`;

				const upgradeTime = new Date(Date.now() + hoursNeeded * 3600000);
				document.getElementById('s3-upgrade-time').textContent = `預計可升級時間：${upgradeTime.toLocaleString()}`;
				
				// 保存資料
				saveFormData('s3');
			}

			// ============ s4 計算器 ============

			// 初始化 s4 的下拉選單
			function initS4() {
				const container = document.getElementById('s4-selects-container');
				for (let i = 1; i <= 5; i++) {
					const label = document.createElement('label');
					label.className = 'factory-label';
					label.textContent = `石英工坊${i}：`;
					const select = document.createElement('select');
					select.id = `s4-factory${i}`;
					select.name = `s4-factory${i}`;
					select.options.add(new Option('選擇等級', ''));
					levelOutput.forEach(item => {
						select.options.add(new Option(`等級 ${item.level}`, item.level));
					});
					container.appendChild(label);
					container.appendChild(select);
					container.appendChild(document.createElement('br'));
				}
				
				// 載入之前保存的資料
				loadFormData('s4');
				// 添加自動保存功能
				addAutoSave('s4');
				// 添加 Enter 鍵觸發計算功能
				addEnterKeyListener('s4');
			}

			// s4 的計算函式
			function calculateS4Output() {
				let total = 0;
				for (let i = 1; i <= 5; i++) {
					const select = document.getElementById(`s4-factory${i}`);
					const level = parseInt(select.value);
					const item = levelOutput.find(item => item.level === level);
					const output = item ? item.output : 0;
					total += output;
				}
				document.getElementById('s4-total-output').textContent = `每小時總產出: ${total}`;

				const current = parseInt(document.getElementById('s4-current-resource').value) || 0;
				const needed = parseInt(document.getElementById('s4-needed-resource').value) || 0;
				const difference = needed - current;
				document.getElementById('s4-difference').textContent = `你還差：${difference}`;

				if (total <= 0) {
					document.getElementById('s4-time-needed').textContent = `無法計算時間 (產出為 0)`;
					document.getElementById('s4-upgrade-time').textContent = `預計可升級時間：無法計算`;
					return;
				}

				const hoursNeeded = difference / total;
				const hours = Math.floor(hoursNeeded);
				const minutes = Math.round((hoursNeeded - hours) * 60);
				document.getElementById('s4-time-needed').textContent = `需要 ${hours} 小時 ${minutes} 分鐘`;

				const upgradeTime = new Date(Date.now() + hoursNeeded * 3600000);
				document.getElementById('s4-upgrade-time').textContent = `預計可升級時間：${upgradeTime.toLocaleString()}`;
				
				// 保存資料
				saveFormData('s4');
			}

			// ============ S4 抗性計算器 ============

			// 抗性數據
			const resistanceData = [
				{ level: 1, resistance: 100 },
				{ level: 2, resistance: 200 },
				{ level: 3, resistance: 300 },
				{ level: 4, resistance: 400 },
				{ level: 5, resistance: 500 },
				{ level: 6, resistance: 850 },
				{ level: 7, resistance: 1000 },
				{ level: 8, resistance: 1250 },
				{ level: 9, resistance: 1500 },
				{ level: 10, resistance: 1750 },
				{ level: 11, resistance: 2000 },
				{ level: 12, resistance: 2250 },
				{ level: 13, resistance: 2500 },
				{ level: 14, resistance: 2750 },
				{ level: 15, resistance: 3000 },
				{ level: 16, resistance: 3400 },
				{ level: 17, resistance: 3800 },
				{ level: 18, resistance: 4200 },
				{ level: 19, resistance: 4600 },
				{ level: 20, resistance: 5000 },
				{ level: 21, resistance: 5500 },
				{ level: 22, resistance: 6000 },
				{ level: 23, resistance: 6500 },
				{ level: 24, resistance: 7000 },
				{ level: 25, resistance: 7500 },
				{ level: 26, resistance: 8000 },
				{ level: 27, resistance: 8500 },
				{ level: 28, resistance: 9000 },
				{ level: 29, resistance: 9500 },
				{ level: 30, resistance: 10000 }
			];

			// L Buff 抗性數據
			const lBuffResistance = [0, 50, 150, 250]; // L0, L1, L2, L3/4

			// 抗性計算函式
			function calculateResistance() {
				// 取得基礎抗性
				const researchLevel = parseInt(document.getElementById('research-level').value) || 0;
				const researchData = resistanceData.find(item => item.level === researchLevel);
				const baseResistance = researchData ? researchData.resistance : 0;

				// 取得各種 buff
				const weeklyCardBuff = document.getElementById('weekly-card-buff').checked ? 250 : 0;
				const lBuffLevel = parseInt(document.getElementById('l-buff').value) || 0;
				const lBuffBonus = lBuffResistance[lBuffLevel] || 0;
				const guardianBuff = document.getElementById('guardian-buff').checked ? 250 : 0;

				// 計算總抗性
				const totalResistance = baseResistance + weeklyCardBuff + lBuffBonus + guardianBuff;

				// 顯示結果
				document.getElementById('base-resistance').textContent = `基礎抗性: ${baseResistance}`;
				
				// 顯示 buff 詳情
				const buffDetails = [];
				if (weeklyCardBuff > 0) buffDetails.push(`週卡: +${weeklyCardBuff}`);
				if (lBuffBonus > 0) buffDetails.push(`L${lBuffLevel}: +${lBuffBonus}`);
				if (guardianBuff > 0) buffDetails.push(`守護者: +${guardianBuff}`);
				
				const buffText = buffDetails.length > 0 ? buffDetails.join(', ') : '無額外 Buff';
				document.getElementById('buff-details').textContent = `Buff 詳情: ${buffText}`;
				
				document.getElementById('total-resistance').textContent = `總抗性: ${totalResistance}`;

				// 保存抗性計算器資料
				saveResistanceData();
			}

			// 保存抗性計算器資料
			function saveResistanceData() {
				const data = {
					researchLevel: document.getElementById('research-level').value,
					weeklyCardBuff: document.getElementById('weekly-card-buff').checked,
					lBuff: document.getElementById('l-buff').value,
					guardianBuff: document.getElementById('guardian-buff').checked
				};
				saveData('s4-resistance', data);
			}

			// 載入抗性計算器資料
			function loadResistanceData() {
				const data = loadData('s4-resistance');
				if (data) {
					if (data.researchLevel) {
						document.getElementById('research-level').value = data.researchLevel;
					}
					if (data.weeklyCardBuff !== undefined) {
						document.getElementById('weekly-card-buff').checked = data.weeklyCardBuff;
					}
					if (data.lBuff !== undefined) {
						document.getElementById('l-buff').value = data.lBuff;
					}
					if (data.guardianBuff !== undefined) {
						document.getElementById('guardian-buff').checked = data.guardianBuff;
					}
				}
			}

			// 初始化抗性計算器
			function initResistanceCalculator() {
				// 載入之前保存的資料
				loadResistanceData();
				
				// 添加自動保存和計算功能
				document.getElementById('research-level').addEventListener('change', () => {
					calculateResistance();
				});
				document.getElementById('weekly-card-buff').addEventListener('change', () => {
					calculateResistance();
				});
				document.getElementById('l-buff').addEventListener('change', () => {
					calculateResistance();
				});
				document.getElementById('guardian-buff').addEventListener('change', () => {
					calculateResistance();
				});
			}

			// 初始化所有計算器
			document.addEventListener('DOMContentLoaded', function () {
				initS2();
				initS3();
				initS4();
				initResistanceCalculator();
			});
		</script>
	</body>
</html>
